# AI작명소 — Handoff Context (2026-02-10)

## 진행 상황 요약

### 완료된 작업
- Next.js 16 + Tailwind v4 + Supabase + OpenAI 프로젝트 구축 완료
- 로그인/결제 기능 전체 제거 → 무료 작명 서비스로 전환
- Vercel 배포 완료 (ai-naming-pa5z.vercel.app)
- GPT 모델: gpt-4o-mini (비용 절감)
- `after()` API로 Vercel 백그라운드 작업 보장
- 폴링 타임아웃 90초 추가 (무한 로딩 방지)
- 한글이름(순우리말) 체크박스 옵션 추가
- 로딩 메시지 범용적 표현으로 교체
- GPT 프롬프트에 획수 공식 + 성씨 40개 획수 + 길흉수 추가

### 미완료 — 다음 작업
**인명용 한자 획수 DB 구축**

1. **데이터 수집**: 이름에 자주 쓰이는 한자 200~300자
   - 한자, 한글 음, 획수(강희자전 기준), 오행(木火土金水)
   - "작명용 한자 목록", "인명용 한자" 등으로 검색

2. **TypeScript lookup table 생성**:
   ```typescript
   // src/lib/hanja/stroke-db.ts
   export const HANJA_STROKES: Record<string, { reading: string; strokes: number; element: string }> = {
     '賢': { reading: '현', strokes: 15, element: '목' },
     '宇': { reading: '우', strokes: 6, element: '토' },
     // ... 200~300자
   };
   ```

3. **서버 측 5격 계산 로직 구현**:
   ```
   천격 = 성 획수 + 1
   인격 = 성 획수 + 이름 첫째자 획수
   지격 = 이름 첫째자 획수 + 이름 둘째자 획수
   외격 = 이름 둘째자 획수 + 1
   총격 = 성 획수 + 이름 첫째자 획수 + 이름 둘째자 획수
   ```

4. **GPT 후처리**: GPT가 이름 생성 → 우리 DB에서 획수 조회 → 5격 직접 계산 → GPT의 strokeAnalysis 덮어쓰기

5. **성씨 획수 DB**: 이미 프롬프트에 40개 있으므로 이것도 별도 DB로 분리

## 핵심 파일
- 프롬프트: `src/lib/gpt/prompt-builder.ts`
- GPT 생성: `src/lib/gpt/naming-generator.ts`
- 파싱: `src/lib/gpt/sections.ts`
- API: `src/app/api/naming/create/route.ts`
- 타입: `src/types/index.ts`

## 환경
- GitHub: MichaelCho-haman/ai-naming
- Vercel: ai-naming-pa5z
- Supabase: 기존 saju-web과 같은 프로젝트 (namings 테이블)

## 결제 보안 재점검 메모
- 결제 관련 코드/설정 변경 시 아래 문서를 먼저 확인하고 위험성 재언급
- `/Users/seonghwancho/Desktop/saju/docs/ai-naming-payment-security-watch.md`
